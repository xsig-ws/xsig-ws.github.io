<?xml version="1.0" encoding="euc-jp"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">


<head>
<link rel="STYLESHEET" href="include/grichal.css" type="text/css" />
<meta http-equiv="Content-Type" content="text/html; charset=euc-jp" />
<title>Grid Challenge in SACSIS 2005</title>
</head>

<h2>規定課題</h2>
<p>
<font color=red>
各マシンのローカルディスクに分散する画像ファイルに含まれる「物体」の総数を
求めよ。
</font>
</p>
<p>
各画像ファイルは巨大な矩形の二値画像(以下、元画像)の一部である。
全ての画像ファイルは一つの正方形領域を表し、一辺の長さは
全てのファイルで等しく、20,000以下である。
画像ファイル群はメッシュ上に並んでいる。つまり、各画像ファイルの
一辺に隣接する画像ファイルは高々一つである。
隣接した画像ファイルは元画像のピクセルを共有しない。
画像の各ピクセルの色は'0'または'1'であり、一つ
の物体は'1'のピクセルが連続した部分と定義される。ここで、
'1'のピクセルが連続しているとは、縦または横方
向に'1'のピクセルが並んでいる場合をいう。
</p>
<p>
各問題には初級または上級の難易度が設定されている。
各問題の難易度は公開される。両難易度
を解答する場合に、同一プログラムを作成しても、別プログラムを作成しても
良い。
</p>

<table>
<tr><td><img src="basic.png"></td></tr>
<caption align="bottom">
<b>図1: </b>A, B, C, Dはそれぞれ一つの物体である。なお、白は'0'のピクセル、
赤は'1'のピクセルを表す。
</caption>
</table>

<dl>
<dt>初級
<dd>
各画像ファイルのふちのピクセルの色が'1'になることはない。
ここで画像ファイルのふちのピクセルとは、画像ファイルの境界線に
接するピクセルを言う。
そのため、それぞれの物体は単一の画像ファイル内に納まる。

したがって初級レベル用のプログラムは、画像ファイル毎に
物体の個数を求め、合計することに
より総数を求めることができる。

<dt>上級
<dd>
<p>
一つの物体は単一の画像ファイル内に納まるか、または多くとも二つの隣
接した画像ファイルにまたがる。
物体が二つの画像ファイルにまたがる場合には、プログラムは正しくそれを1 
個と数えなければならない。
</p>
<p>
そのような、ファイルにまたがる物体の形状は、
以下のような条件を満たしていることが保証される。物体のファイル境界によ
る「切れ目」は必ず一つの連続した線分となっている。たとえば、ドーナツ型
の物体の真中をファイル境界が切断することは無い。より詳細には、以下のよ
うになる。一つの物体が、画像ファイルFAと、元画像上でその右に位置する画
像ファイルFBにまたがるとする。このとき、FAの右端のピクセルの集合と物体
を表すピクセル集合の共通集合は、連結である。FBの左端のピクセルの集合と
物体を表すピクセル集合の共通集合もまた、連結である。一つの物体が上下に
隣接したファイルにまたがる場合も同様とする。
</p>
</dl>

<table>
<tr><td><img src="span-ok.png"></td></tr>
<caption align="bottom">
<b>図2: </b> 上級においては、本図のような物体が存在しうる。
ちょうどファイル境界と物体の境界が一致する場合はありうる。
</caption>
</table>

<table>
<tr><td><img src="span-ng.png"></td></tr>
<caption align="bottom">
<b>図3: </b> 本図のような物体は存在しない。
Aは3つのファイルにまたがっている。Bはファイル境界による切れ目が
連続していない。Cは上側のファイルのふちにおいて切れ目が連続していない。
</caption>
</table>

<h3>マスターファイルとレプリカファイル</h3>
<p>
各画像ファイルには、マスターとレプリカの2種類がある。それぞれの分割画
像に対し、マスターファイルは全マシンを通して一つのみ存在する。また、
各画像のレプリカの数は0個以上100個以下である。
それぞれの分割画像の、マスターファ
イルと全てのレプリカファイルは同一の内容である。
</p>
<p>
プログラムはマスターファイルのみを用いて総数を求めることが可能である。一
方、レプリカファイルも用いることにより、より効率的に問題を解けるかもしれ
ない。その場合、物体をだぶって数えないよう注意が必要である。
</p>

<h3>画像ファイル名</h3>

各画像ファイルは以下のようなファイル名を持つ。

<ul>
<li> <b>マスター:</b> PPXXXYYY.mdt 
<li> <b>レプリカ:</b> PPXXXYYY.rdt
</ul>

<p>
ただし、PPは問題番号(2桁)、XXXはファイルのX位置(3桁)、
YYYはファイルのY位置(3桁)である。
X位置は、一番左を0番目として、そのファイルが左から何番目かを表す。
Y位置は、一番上を0番目として、そのファイルが上から何番目かを表す。
本説明では省かれているが、出題APIから得られるファイル名は、前にディレ
クトリ名のついたフルパス名である。PP, XXX, YYYとも左にゼロ詰めがされている。
</p>
<p>
例: 01012008.mdt は問題番号1の、左から12番目、上から8番目の画像のマス
ターファイルである。
</p>

<h3>画像フォーマット</h3>
<h4>復号化</h4>
<p>
画像ファイルは簡易暗号化されており、出題APIから得られる復号化鍵によって復号
する必要がある。画像ファイル中の各byteと復号化鍵中の各byteを順にXOR演算する
ことにより復号が行なわれる。復号化鍵のbyte列はcyclicに用いられる。
</p>
<p>
つまり、以下のようになる。暗号化画像ファイルのbyte列をC、復号後のbyte
列をPとする。復号化鍵のbyte列をKとし、その長さがL bytesであるとすると、
P[i] = C[i]^K[i % L]となる。(ただし、^はXOR演算、%は剰余演算とする)
</p>

<h4>画像データ</h4>

<p>
復号化された画像ファイルにはrun-length方式で圧縮された二値画像データが
格納されている。画像ファイルは、4bytesのヘッダ部とそれに続くデータ部か
らなる。
</p>
<p>
ヘッダ部は以下のような構造である。
</p>
<table border>
<tr> <td> 0--1byte </td> <td> 画像の幅(ピクセル) </td> </tr>
<tr> <td> 2--3byte </td> <td> 画像の高さ(ピクセル) </td> </tr>
</table>
<p>
幅と高さはそれぞれ16bitsの整数で表されている。
バイトオーダーはリトルエンディアン
(Pentiumのバイトオーダー)である。
本課題においてはそれぞれの画像ファイルは正方形であるため、幅と高さは
同じ値である。
</p>

<p>
データ部は、1byteまたは2bytesで表される`run'の列である。runとは同じ色
が連続して現われる部分である。画像上のデータは左上から右へ向かう順で格
納され、ラインの右端の次にはその下のラインの左端が格納される。一つの
runが複数のラインにまたがることがある。
</p>
<p>
Runは以下のような構造である。なお、1byte runと2bytes runは最上位ビット
により区別される。
以下の表において、bit7は最上位ビット(MSB)、bit0は最下位ビット(LSB)
を表す。
</p>

<dl>
<dt>1byte run
<dd>
<table border>
<tr> <td> bit7 </td> <td> '0' </td> </tr>
<tr> <td> bit6 </td> <td> data </td> </tr>
<tr> <td> bit5--0 </td> <td> lenm1 </td> </tr>
</table>

dataで表される色が、(lenm1+1)ピクセル連続して現われることを意味する。

<dt>2bytes run
<dd>
0byte目

<table border>
<tr> <td> bit7 </td> <td> '1' </td> </tr>
<tr> <td> bit6 </td> <td> data </td> </tr>
<tr> <td> bit5--0 </td> <td> lenm1H </td> </tr>
</table>

1byte目

<table border>
<tr> <td> bit7--0 </td> <td> lenm1L </td> </tr>
</table>

dataで表される色が、(lenm1H*256+lenm1L+1)ピクセル連続して現われること
を意味する。

</dl>

<h3>ノード故障への対応</h3>
予選・決勝期間中には画像ファイルが各ノードに分散配置されている。
しかし、予選期間中に突然ノードの故障が起きるなど、一時的に画像ファイルに
欠落ができる場合がある。また、CPU資源を獲得する際に、なんらかの
理由により全ノードでプログラムを開始することに失敗する可能性がある。
<br>
そのような、全画像ファイルを取得できるとは限らない場合においてもプログラムの
動作確認を可能にするために、
以下のような対応を取る。
プログラムは取得に成功した全ファイルについて、含まれる物体の数
の合計を求めることとする。
その後プログラムは解答を出題APIに報告する際に、解答に用いたファイル集合を
表すデータも共に報告する(詳細は出題API記述を参照)。
APIは、用いられたファイルの範囲において解答が正しいかどうかを調べ、
判定を返す。
なお、ファイルが抜けている箇所は全てピクセルの色が'0'であると考えること。

</html>
